<div class="mx-auto max-w-5xl px-4 py-8 sm:px-6 lg:px-8" data-controller="scroll-to-top">
  <!-- Header con acciones -->
  <div class="mb-8">
    <!-- Título y acciones -->
    <div class="mb-6">
      <div class="mb-3 flex flex-wrap items-center gap-2 sm:gap-3">
        <%= link_to projects_path, class: "text-gray-400 hover:text-gray-500 transition shrink-0" do %>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <% end %>
        <h1 class="break-word min-w-0 text-2xl font-bold text-gray-900 sm:text-3xl"><%= @project.title %></h1>
        <% if @project.genre.present? %>
        <span
          class="bg-primary-100 text-primary-800 inline-flex shrink-0 items-center rounded-full px-2 py-1 text-xs font-medium sm:px-3 sm:text-sm"
        >
          <%= @project.genre %>
        </span>
        <% end %>
      </div>
      <p class="ml-0 text-sm text-gray-500 sm:ml-8">
        Última actualización: <%= time_ago_in_words(@project.updated_at) %>
      </p>
    </div>

    <!-- Menú de acciones -->
    <div class="mb-6 grid grid-cols-2 gap-2 sm:gap-3 md:grid-cols-4">
      <!-- Primary action: Edit -->
      <%= link_to edit_project_path(@project), class: "inline-flex items-center justify-center px-3 sm:px-4 py-2 border
      border-transparent rounded-md shadow-sm text-xs sm:text-sm font-medium text-white bg-primary
      hover:bg-secondary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition
      whitespace-nowrap" do %>
      <svg
        class="mr-1.5 -ml-0.5 h-4 w-4 sm:mr-2 sm:-ml-1 sm:h-5 sm:w-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
        />
      </svg>
      Editar <% end %>

      <!-- Secondary action: Structure -->
      <%= link_to project_structure_path(@project), class: "inline-flex items-center justify-center px-3 sm:px-4 py-2
      border border-transparent rounded-md shadow-sm text-xs sm:text-sm font-medium text-white bg-green-600
      hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition
      whitespace-nowrap" do %>
      <svg
        class="mr-1.5 -ml-0.5 h-4 w-4 sm:mr-2 sm:-ml-1 sm:h-5 sm:w-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
      </svg>
      Estructura <% end %>

      <!-- Utility actions: Export group -->
      <%= link_to report_project_path(@project, format: :pdf), target: "_blank", class: "inline-flex items-center
      justify-center px-3 sm:px-4 py-2 border border-gray-300 rounded-md shadow-sm text-xs sm:text-sm font-medium
      text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500
      transition whitespace-nowrap" do %>
      <svg
        class="mr-1.5 -ml-0.5 h-4 w-4 text-red-600 sm:mr-2 sm:-ml-1 sm:h-5 sm:w-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
        />
      </svg>
      <span class="hidden sm:inline">Generar</span>
      PDF <% end %> <%= link_to fountain_export_project_path(@project), data: { turbo: false }, class: "inline-flex
      items-center justify-center px-3 sm:px-4 py-2 border border-gray-300 rounded-md shadow-sm text-xs sm:text-sm
      font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2
      focus:ring-gray-500 transition whitespace-nowrap" do %>
      <svg
        class="mr-1.5 -ml-0.5 h-4 w-4 text-blue-600 sm:mr-2 sm:-ml-1 sm:h-5 sm:w-5"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
        />
      </svg>
      <span class="hidden sm:inline">Exportar</span>
      Fountain <% end %>
    </div>

    <!-- Navegación de tabs -->
    <div class="-mx-4 overflow-x-auto border-b border-gray-200 px-4 sm:mx-0 sm:overflow-x-visible sm:px-0">
      <nav class="-mb-px flex min-w-max space-x-3 sm:min-w-0 sm:space-x-6 md:space-x-8">
        <a
          href="#tratamiento"
          class="border-primary text-primary border-b-2 px-0.5 py-3 text-xs font-medium whitespace-nowrap sm:px-1 sm:py-4 sm:text-sm"
        >
          Tratamiento
        </a>
        <%= link_to project_characters_path(@project), class: "border-transparent text-gray-500 hover:text-gray-700
        hover:border-gray-300 whitespace-nowrap py-3 sm:py-4 px-0.5 sm:px-1 border-b-2 font-medium text-xs sm:text-sm
        transition" do %> Personajes
        <span class="ml-1 rounded-full bg-gray-100 px-1 py-0.5 text-xs text-gray-900 sm:ml-2 sm:px-2.5">
          <%= @project.characters.count %>
        </span>
        <% end %> <%= link_to project_locations_path(@project), class: "border-transparent text-gray-500
        hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 sm:py-4 px-0.5 sm:px-1 border-b-2 font-medium
        text-xs sm:text-sm transition" do %> Locaciones
        <span class="ml-1 rounded-full bg-gray-100 px-1 py-0.5 text-xs text-gray-900 sm:ml-2 sm:px-2.5">
          <%= @project.locations.count %>
        </span>
        <% end %> <%= link_to project_ideas_path(@project), class: "border-transparent text-gray-500 hover:text-gray-700
        hover:border-gray-300 whitespace-nowrap py-3 sm:py-4 px-0.5 sm:px-1 border-b-2 font-medium text-xs sm:text-sm
        transition" do %> Ideas
        <span class="ml-1 rounded-full bg-gray-100 px-1 py-0.5 text-xs text-gray-900 sm:ml-2 sm:px-2.5">
          <%= @project.ideas.count %>
        </span>
        <% end %>
      </nav>
    </div>
  </div>

  <!-- Contenido del Tratamiento -->
  <div class="space-y-8">
    <!-- Información Básica -->
    <% if @project.tone.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Tono</h2>
      <p class="text-gray-700"><%= @project.tone %></p>
    </div>
    <% end %>

    <!-- Logline -->
    <% if @project.logline.present? %>
    <div class="bg-gradient-primary-light border-primary rounded-r-lg border-l-4 p-6">
      <h2 class="mb-3 text-xl font-semibold text-gray-900">Logline</h2>
      <p class="text-lg text-gray-800 italic"><%= @project.logline %></p>
    </div>
    <% end %>

    <!-- Idea -->
    <% if @project.idea.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Idea</h2>
      <p class="whitespace-pre-wrap text-gray-700"><%= @project.idea %></p>
    </div>
    <% end %>

    <!-- Storyline -->
    <% if @project.storyline.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Storyline</h2>
      <p class="whitespace-pre-wrap text-gray-700"><%= @project.storyline %></p>
    </div>
    <% end %>

    <!-- Sinopsis -->
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
      <% if @project.short_synopsis.present? %>
      <div class="rounded-lg bg-white p-6 shadow">
        <h2 class="mb-4 text-xl font-semibold text-gray-900">Sinopsis Corta</h2>
        <p class="whitespace-pre-wrap text-gray-700"><%= @project.short_synopsis %></p>
      </div>
      <% end %> <% if @project.long_synopsis.present? %>
      <div class="rounded-lg bg-white p-6 shadow lg:col-span-2">
        <h2 class="mb-4 text-xl font-semibold text-gray-900">Sinopsis Larga</h2>
        <p class="whitespace-pre-wrap text-gray-700"><%= @project.long_synopsis %></p>
      </div>
      <% end %>
    </div>

    <!-- Mundo -->
    <% if @project.world.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Mundo / Universo Narrativo</h2>
      <p class="whitespace-pre-wrap text-gray-700"><%= @project.world %></p>
    </div>
    <% end %>

    <!-- Temas -->
    <% if @project.themes.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Temas</h2>
      <p class="whitespace-pre-wrap text-gray-700"><%= @project.themes %></p>
    </div>
    <% end %>

    <!-- Personajes (Resumen) -->
    <% if @project.characters_summary.present? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <h2 class="mb-4 text-xl font-semibold text-gray-900">Resumen de Personajes</h2>
      <p class="whitespace-pre-wrap text-gray-700"><%= @project.characters_summary %></p>
    </div>
    <% end %>

    <!-- Estado vacío si no hay información -->
    <% if @project.tone.blank? && @project.logline.blank? && @project.idea.blank? && @project.storyline.blank? &&
    @project.short_synopsis.blank? && @project.long_synopsis.blank? && @project.world.blank? && @project.themes.blank?
    && @project.characters_summary.blank? %>
    <div class="rounded-lg bg-white py-12 text-center shadow">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
        />
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">Sin información de tratamiento</h3>
      <p class="mt-1 text-sm text-gray-500">Empieza con un logline, idea o storyline para definir tu proyecto.</p>
      <div class="mt-6">
        <%= link_to "Agregar Información", edit_project_path(@project), class: "inline-flex items-center px-4 py-2
        border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-secondary-dark
        focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary" %>
      </div>
    </div>
    <% end %>

    <!-- Divider -->
    <div class="relative">
      <div class="absolute inset-0 flex items-center" aria-hidden="true">
        <div class="w-full border-t border-gray-300"></div>
      </div>
      <div class="relative flex justify-center">
        <span class="bg-gray-50 px-3 text-sm text-gray-500">Estructura Dramática</span>
      </div>
    </div>

    <!-- Resumen de Estructura -->
    <% if @project.acts.any? %>
    <div class="rounded-lg bg-white p-6 shadow">
      <div class="mb-4 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <h2 class="text-xl font-semibold text-gray-900">Estructura</h2>
          <span
            class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600"
          >
            Vista Resumida
          </span>
        </div>
        <%= link_to project_structure_path(@project), class: "text-primary hover:text-primary-900 text-sm font-medium"
        do %> Ver tablero completo → <% end %>
      </div>

      <div class="space-y-4">
        <% @project.acts.ordered.each do |act| %>
        <div class="border-primary border-l-4 pl-4">
          <h3 class="font-semibold text-gray-900"><%= act.title %></h3>
          <% if act.description.present? %>
          <p class="mt-1 text-sm text-gray-600"><%= act.description.truncate(150) %></p>
          <% end %> <% if act.sequences.any? %>
          <div class="mt-2 text-xs text-gray-500">
            <%= pluralize(act.sequences.count, "secuencia") %> • <%= pluralize(act.scenes.count, "escena") %>
          </div>
          <% end %>
        </div>
        <% end %>
      </div>
    </div>
    <% else %>
    <div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-8">
      <div class="text-center">
        <svg class="mx-auto h-10 w-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
        <h3 class="mt-3 text-sm font-medium text-gray-900">Sin estructura dramática</h3>
        <p class="mt-2 text-sm text-gray-500">Organiza tu narrativa creando actos, secuencias y escenas.</p>
        <div class="mt-4">
          <%= link_to project_structure_path(@project), class: "inline-flex items-center px-4 py-2 border
          border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700
          focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition" do %>
          <svg class="mr-2 -ml-1 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Ir a Estructura <% end %>
        </div>
      </div>
    </div>
    <% end %>
  </div>

  <!-- Scroll to Top Button -->
  <button
    type="button"
    data-scroll-to-top-target="button"
    data-action="click->scroll-to-top#scrollToTop"
    class="bg-primary hover:bg-secondary-dark focus:ring-primary fixed right-6 bottom-6 z-40 hidden rounded-full p-3 text-white opacity-0 shadow-lg transition-all duration-300 focus:ring-2 focus:ring-offset-2 focus:outline-none sm:p-4"
    aria-label="Scroll to top"
  >
    <svg class="h-5 w-5 sm:h-6 sm:w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
  </button>
</div>
