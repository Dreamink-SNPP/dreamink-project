<!-- Tarjeta de Secuencia -->
<div id="sequence_<%= sequence.id %>"
     class="sequence-card bg-gray-50 rounded-lg border border-gray-200"
     data-controller="collapsible"
     data-collapsible-storage-key-value="sequence"
     data-sortable-id="<%= sequence.id %>">

  <!-- Header de la Secuencia -->
  <div class="p-3 border-b border-gray-200">
    <div class="flex items-start justify-between">
      <!-- Drag Handle -->
      <div class="drag-handle mr-2 pt-0.5 text-gray-400 hover:text-gray-600 transition cursor-grab">
        <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"></path>
        </svg>
      </div>

      <div class="flex-1">
        <h4 class="text-sm font-semibold text-gray-900">
          <%= sequence.title %>
        </h4>
        <% if sequence.description.present? %>
          <p class="mt-1 text-xs text-gray-600 line-clamp-2">
            <%= sequence.description %>
          </p>
        <% end %>
      </div>

      <!-- Acciones de la secuencia -->
      <div class="ml-2 flex space-x-1">
        <button type="button"
                data-action="click->structure#openEditSequenceModal"
                data-sequence-id="<%= sequence.id %>"
                class="text-gray-400 hover:text-indigo-600 p-1"
                title="Editar secuencia">
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
        </button>

        <%= button_to project_sequence_path(project, sequence),
                      method: :delete,
                      data: { turbo_confirm: "Â¿Eliminar esta secuencia y sus escenas?" },
                      class: "text-gray-400 hover:text-red-600 p-1",
                      title: "Eliminar secuencia" do %>
          <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
        <% end %>
      </div>
    </div>

    <!-- Toggle para mostrar/ocultar escenas -->
    <button type="button"
            data-action="click->collapsible#toggle"
            data-target-id="scenes-<%= sequence.id %>"
            class="mt-2 text-xs text-gray-500 hover:text-gray-700 flex items-center transition">
      <svg class="h-4 w-4 mr-1 transform transition-transform"
           style="transform: rotate(-90deg)"
           fill="none"
           stroke="currentColor"
           viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
      <%= pluralize(sequence.scenes.count, "escena") %>
    </button>
  </div>

  <!-- Lista de Escenas (colapsable) -->
  <div id="scenes-<%= sequence.id %>" class="hidden">
    <div id="sequence_<%= sequence.id %>_scenes"
         class="p-2 space-y-2 min-h-[100px]"
         data-controller="sortable"
         data-sortable-url-value="<%= project_reorder_structure_path(@project) %>"
         data-sortable-type-value="scene"
         data-sortable-group-value="scenes"
         data-sortable-parent-id-value="<%= sequence.id %>"
         data-sortable-parent-id="<%= sequence.id %>">

        <% sequence.scenes.each do |scene| %>
          <%= render "structures/scene_item", scene: scene, project: project %>
        <% end %>

        <% if sequence.scenes.empty? %>
          <div class="text-center py-4 text-gray-400 text-xs pointer-events-none">
            <p>Sin escenas</p>
          </div>
        <% end %>
      </div>

      <div class="p-2 border-t border-gray-100">
        <button type="button"
                data-action="click->structure#openNewSceneModal"
                data-sequence-id="<%= sequence.id %>"
                class="w-full py-1.5 px-3 border border-dashed border-gray-300 rounded text-xs font-medium text-gray-500 hover:border-indigo-400 hover:text-indigo-600 transition">
          + Agregar Escena
        </button>
      </div>
    </div>
</div>
