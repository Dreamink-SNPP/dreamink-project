<!-- Toggle para mostrar/ocultar escenas (solo mÃ³vil) -->
<button type="button"
        data-action="click->collapsible#toggle"
        data-target-id="scenes-<%= sequence.id %>"
        data-sequence-toggle="<%= sequence.id %>"
        class="lg:hidden mt-2 text-xs text-gray-500 hover:text-gray-700 flex items-center transition">
  <span class="h-4 w-4 mr-1 transform transition-transform" data-sequence-icon="<%= sequence.id %>">
    <%= heroicon "chevron-down", size: "4" %>
  </span>
  <%= pluralize(sequence.scenes.count, "escena") %>
</button>

<!-- Contador de escenas (solo desktop) -->
<div class="hidden lg:block mt-2 text-xs text-gray-500">
  <%= pluralize(sequence.scenes.count, "escena") %>
</div>

<script>
  // Restore icon state immediately after partial renders
  (function() {
    const targetId = 'scenes-<%= sequence.id %>';
    const icon = document.querySelector('[data-sequence-icon="<%= sequence.id %>"]');
    const content = document.getElementById(targetId);

    if (icon && content) {
      const isExpanded = !content.classList.contains('hidden');
      icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(-90deg)';
    }
  })();
</script>
